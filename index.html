<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”Œë¼ìŠ¤í¬ - ë§¤ì¶œÂ·ê´‘ê³ Â·í• ì¸ ì¢…í•©ë¶„ì„</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        /* í”Œë¼ìŠ¤í¬ - ë² ì´ì§í•œ ê·¸ë ˆì´ìŠ¤ì¼€ì¼ ëŒ€ì‹œë³´ë“œ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-weight: 400;
            background-color: #fafafa;
            color: #2d3748;
            line-height: 1.5;
        }

        /* ë„¤ë¹„ê²Œì´ì…˜ */
        .navbar {
            padding: 1rem 0;
            border-bottom: 1px solid #e2e8f0;
            background-color: white;
        }

        .navbar-brand {
            font-size: 1.5rem;
            font-weight: 500;
            color: #1a202c !important;
            letter-spacing: -0.025em;
        }

        .navbar-brand i {
            width: 24px;
            height: 24px;
            color: #4a5568;
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ - ë² ì´ì§ */
        .btn {
            font-weight: 400;
            border-radius: 6px;
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            transition: all 0.15s ease;
            display: inline-flex;
            align-items: center;
            font-size: 0.875rem;
            background-color: white;
            color: #374151;
        }

        .btn i {
            width: 16px;
            height: 16px;
        }

        .btn:hover {
            background-color: #f9fafb;
            border-color: #9ca3af;
            transform: none;
            box-shadow: none;
        }

        .btn-primary {
            background-color: #374151;
            border-color: #374151;
            color: white;
        }

        .btn-primary:hover {
            background-color: #1f2937;
            border-color: #1f2937;
            color: white;
        }

        /* ì¹´ë“œ ê¸°ë³¸ ìŠ¤íƒ€ì¼ - ë² ì´ì§ */
        .card {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            box-shadow: none;
            background: white;
            transition: none;
        }

        .card:hover {
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transform: none;
        }

        .card-header {
            background-color: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
            padding: 1rem 1.25rem;
            border-radius: 8px 8px 0 0;
        }

        .card-header h5 {
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            margin: 0;
            display: flex;
            align-items: center;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .card-header h5 i {
            width: 16px;
            height: 16px;
            color: #6b7280;
            margin-right: 0.5rem;
        }

        .card-body {
            padding: 1.25rem;
        }

        /* ê³„ì‚°ê¸° ì „ìš© ìŠ¤íƒ€ì¼ */
        .metric-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid #f3f4f6;
        }

        .metric-item:last-child {
            border-bottom: none;
        }

        .metric-label {
            font-size: 0.875rem;
            color: #6b7280;
            font-weight: 400;
        }

        .metric-value {
            font-size: 1rem;
            font-weight: 600;
            color: #1f2937;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
        }

        .summary-label {
            font-size: 0.875rem;
            color: #6b7280;
            font-weight: 400;
        }

        .summary-value {
            font-size: 0.875rem;
            color: #374151;
            font-weight: 500;
        }

        /* í¼ ìŠ¤íƒ€ì¼ ê°œì„  */
        .form-text {
            font-size: 0.75rem;
            color: #9ca3af;
            margin-top: 0.25rem;
        }

        /* ê²°ê³¼ ì»¨í…Œì´ë„ˆ */
        #resultsContainer {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ì›°ì»´ ë©”ì‹œì§€ */
        #welcomeMessage {
            background-color: #f9fafb;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        /* ì…ë ¥ í¼ ê°œì„  */
        .form-control:focus {
            border-color: #6b7280;
            box-shadow: 0 0 0 2px rgba(107, 114, 128, 0.1);
        }

        /* ì„¹ì…˜ ì œëª© */
        h6.text-muted {
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #e5e7eb;
        }

        /* ê³µì‹ ì„¤ëª… ìŠ¤íƒ€ì¼ */
        .formula-text {
            font-size: 0.75rem;
            color: #9ca3af;
            font-style: italic;
            margin-top: 0.25rem;
            padding: 0.25rem 0.5rem;
            background-color: #f9fafb;
            border-radius: 4px;
            border-left: 3px solid #d1d5db;
        }

        .metric-label.formula-text {
            background: none;
            border: none;
            padding: 0;
            margin: 0;
            font-style: italic;
            color: #9ca3af;
        }

        .text-primary { color: #374151 !important; }
        .text-danger { color: #dc2626 !important; }
        .text-warning { color: #d97706 !important; }
        .text-success { color: #059669 !important; }

        /* ë³´ê³ ì„œ ì¶”ì¶œ ë²„íŠ¼ í˜¸ë²„ íš¨ê³¼ */
        #exportReportBtn:hover {
            background-color: #1f2937 !important;
            border-color: #1f2937 !important;
            color: white !important;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        #exportReportBtn:hover i {
            color: white !important;
        }

        .form-control {
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            transition: border-color 0.15s ease;
            background-color: white;
        }

        .form-label {
            font-weight: 500;
            color: #374151;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        .alert {
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            font-size: 0.875rem;
            background-color: #f9fafb;
            color: #4b5563;
        }

        .alert-danger {
            background-color: #fef2f2;
            color: #b91c1c;
            border-color: #fecaca;
        }

        .alert-success {
            background-color: #f0fdf4;
            color: #166534;
            border-color: #bbf7d0;
        }

        .container-fluid {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-light bg-white border-bottom">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">
                <i data-lucide="flask" class="me-2"></i>í”Œë¼ìŠ¤í¬
            </span>
            <div class="d-flex">
                <span class="text-muted small">ë§¤ì¶œÂ·ê´‘ê³ Â·í• ì¸ ì¢…í•©ë¶„ì„</span>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <div class="row">
            <!-- ì…ë ¥ í¼ -->
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5><i data-lucide="calculator" class="me-2"></i>ë°ì´í„° ì…ë ¥</h5>
                    </div>
                    <div class="card-body">
                        <form id="analysisForm">
                            <!-- ì§‘ê³„ê¸°ê°„ ì„¤ì • -->
                            <div class="mb-4">
                                <h6 class="text-muted mb-3">ì§‘ê³„ê¸°ê°„</h6>
                                <div class="mb-3">
                                    <label for="start_date" class="form-label">ì‹œì‘ì¼</label>
                                    <input type="date" class="form-control" id="start_date" name="start_date">
                                </div>
                                <div class="mb-3">
                                    <label for="end_date" class="form-label">ì¢…ë£Œì¼</label>
                                    <input type="date" class="form-control" id="end_date" name="end_date">
                                </div>
                                <div class="mb-3">
                                    <div class="form-text">ê¸°ë³¸ê°’: ì–´ì œë¶€í„° 14ì¼ê°„ (ì˜ˆ: ì˜¤ëŠ˜ì´ 9/17ì´ë©´ 9/3~9/16)</div>
                                </div>
                            </div>

                            <!-- ë§¤ì¶œì •ë³´ -->
                            <div class="mb-4">
                                <h6 class="text-muted mb-3">ë§¤ì¶œì •ë³´</h6>
                                <div class="mb-3">
                                    <label for="sales_amount" class="form-label">ë§¤ì¶œì•¡ (ì›)</label>
                                    <input type="number" class="form-control" id="sales_amount" name="sales_amount" placeholder="0" min="0" step="0.01">
                                    <div class="form-text">ì´ íŒë§¤ ê¸ˆì•¡ (ê³ ê°ì´ ì§€ë¶ˆí•œ ì „ì²´ ê¸ˆì•¡)</div>
                                </div>
                                <div class="mb-3">
                                    <label for="refund_amount" class="form-label">í™˜ë¶ˆê¸ˆì•¡ (ì›)</label>
                                    <input type="number" class="form-control" id="refund_amount" name="refund_amount" placeholder="0" min="0" step="0.01">
                                    <div class="form-text">ê³ ê°ì—ê²Œ í™˜ë¶ˆí•œ ì´ ê¸ˆì•¡</div>
                                </div>
                            </div>

                            <!-- í• ì¸ì •ë³´ -->
                            <div class="mb-4">
                                <h6 class="text-muted mb-3">í• ì¸ì •ë³´</h6>
                                <div class="mb-3">
                                    <label for="total_discount" class="form-label">ì´í• ì¸ì•¡ (ì›)</label>
                                    <input type="number" class="form-control" id="total_discount" name="total_discount" placeholder="0" min="0" step="0.01">
                                    <div class="form-text">ìƒí’ˆì— ì ìš©ëœ ì´ í• ì¸ ê¸ˆì•¡ (ì¿ í°, í”„ë¡œëª¨ì…˜ ë“±)</div>
                                </div>
                            </div>

                            <!-- ê´‘ê³ ì •ë³´ -->
                            <div class="mb-4">
                                <h6 class="text-muted mb-3">ê´‘ê³ ì •ë³´</h6>
                                <div class="mb-3">
                                    <label for="advertising_cost" class="form-label">ê´‘ê³ ì‹¤ë¹„ (ì›)</label>
                                    <input type="number" class="form-control" id="advertising_cost" name="advertising_cost" placeholder="0" min="0" step="0.01">
                                    <div class="form-text">ê´‘ê³  í”Œë«í¼ì— ì§€ì¶œí•œ ì´ ê´‘ê³ ë¹„ (Google, Facebook, Naver ë“±)</div>
                                </div>
                                <div class="mb-3">
                                    <label for="target_ratio" class="form-label">ëª©í‘œ ê´‘ê³ ë¹„ìœ¨ (%)</label>
                                    <input type="number" class="form-control" id="target_ratio" name="target_ratio" placeholder="10" min="0" max="100" step="0.01" value="10">
                                    <div class="form-text">ê¸°ë³¸ê°’: 10% (í•˜í•œì„  7.5%, ìƒí•œì„  15%) - ë³´ì •ê´‘ê³ ë¹„ìœ¨ ê³„ì‚°ì— ì‚¬ìš©</div>
                                </div>
                            </div>

                            <div class="d-flex flex-column align-items-center gap-3">
                                <button type="submit" class="btn btn-primary w-100 d-flex align-items-center justify-content-center" style="height: 50px; font-size: 16px; font-weight: 500;">
                                    <i data-lucide="play" class="me-2"></i>ë¶„ì„ ê³„ì‚°
                                </button>
                                <button type="button" class="btn btn-outline-primary w-100 d-flex align-items-center justify-content-center" id="exportReportBtn" style="display: none; height: 50px; font-size: 16px; font-weight: 500;" onclick="exportReport()">
                                    <i data-lucide="file-text" class="me-2"></i>ë³´ê³ ì„œ ì¶”ì¶œ
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- ê²°ê³¼ í‘œì‹œ -->
            <div class="col-md-8">
                <div id="resultsContainer" style="display: none;">
                    <!-- ë§¤ì¶œì •ë³´ ê²°ê³¼ -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5><i data-lucide="trending-up" class="me-2"></i>ë§¤ì¶œì •ë³´</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="metric-item">
                                        <span class="metric-label">ë§¤ì¶œì•¡</span>
                                        <span class="metric-value" id="sales_amount_result">â‚©0</span>
                                    </div>
                                    <div class="metric-item">
                                        <span class="metric-label">í™˜ë¶ˆê¸ˆì•¡</span>
                                        <span class="metric-value text-danger" id="refund_amount_result">â‚©0</span>
                                    </div>
                                    <div class="metric-item">
                                        <span class="metric-label">í™˜ë¶ˆë¹„ìœ¨</span>
                                        <span class="metric-value" id="refund_ratio_result">0%</span>
                                    </div>
                                    <div class="metric-item">
                                        <span class="metric-label formula-text">í™˜ë¶ˆë¹„ìœ¨ = í™˜ë¶ˆê¸ˆì•¡ Ã· ë§¤ì¶œì•¡</span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="metric-item">
                                        <span class="metric-label">ìˆœë§¤ì¶œì•¡</span>
                                        <span class="metric-value text-primary" id="net_sales_result">â‚©0</span>
                                    </div>
                                    <div class="metric-item">
                                        <span class="metric-label formula-text">ìˆœë§¤ì¶œì•¡ = ë§¤ì¶œì•¡ - í™˜ë¶ˆê¸ˆì•¡</span>
                                    </div>
                                    <div class="metric-item">
                                        <span class="metric-label">ì¼í‰ê·  ìˆœë§¤ì¶œ</span>
                                        <span class="metric-value" id="daily_avg_net_sales_result">â‚©0</span>
                                    </div>
                                    <div class="metric-item">
                                        <span class="metric-label formula-text">ì¼í‰ê·  = ìˆœë§¤ì¶œì•¡ Ã· ì´ ì¼ìˆ˜</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- í• ì¸ì •ë³´ ê²°ê³¼ -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5><i data-lucide="percent" class="me-2"></i>í• ì¸ì •ë³´</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="metric-item">
                                        <span class="metric-label">ì´í• ì¸ì•¡</span>
                                        <span class="metric-value" id="total_discount_result">â‚©0</span>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="metric-item">
                                        <span class="metric-label">ì‹¤í• ì¸ì•¡</span>
                                        <span class="metric-value text-warning" id="effective_discount_result">â‚©0</span>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="metric-item">
                                        <span class="metric-label">ì‹¤í• ì¸ë¥ </span>
                                        <span class="metric-value" id="effective_discount_ratio_result">0%</span>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="metric-item">
                                        <span class="metric-label formula-text">ì‹¤í• ì¸ì•¡ = ì´í• ì¸ì•¡ Ã— (1 - í™˜ë¶ˆë¹„ìœ¨)</span>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="metric-item">
                                        <span class="metric-label formula-text">ì‹¤í• ì¸ë¥  = ì‹¤í• ì¸ì•¡ Ã· (ìˆœë§¤ì¶œì•¡ + ì‹¤í• ì¸ì•¡)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ê´‘ê³ ì •ë³´ ê²°ê³¼ -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5><i data-lucide="megaphone" class="me-2"></i>ê´‘ê³ ì •ë³´</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="metric-item">
                                        <span class="metric-label">ê´‘ê³ ì‹¤ë¹„</span>
                                        <span class="metric-value" id="advertising_cost_result">â‚©0</span>
                                    </div>
                                    <div class="metric-item">
                                        <span class="metric-label">ì¼í‰ê·  ê´‘ê³ ì‹¤ë¹„</span>
                                        <span class="metric-value" id="daily_avg_advertising_result">â‚©0</span>
                                    </div>
                                    <div class="metric-item">
                                        <span class="metric-label">ë§¤ì¶œëŒ€ë¹„ ê´‘ê³ ë¹„ìœ¨</span>
                                        <span class="metric-value" id="sales_advertising_ratio_result">0%</span>
                                    </div>
                                    <div class="metric-item">
                                        <span class="metric-label formula-text">ë§¤ì¶œëŒ€ë¹„ ê´‘ê³ ë¹„ìœ¨ = ê´‘ê³ ì‹¤ë¹„ Ã· ìˆœë§¤ì¶œì•¡</span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="metric-item">
                                        <span class="metric-label">ë³´ì •ê´‘ê³ ë¹„ìœ¨</span>
                                        <span class="metric-value text-success" id="corrected_ratio_result">0%</span>
                                    </div>
                                    <div class="metric-item">
                                        <span class="metric-label formula-text">ë³´ì •ê´‘ê³ ë¹„ìœ¨ = (ëª©í‘œë¹„ìœ¨Â²) Ã· ë§¤ì¶œëŒ€ë¹„ ê´‘ê³ ë¹„ìœ¨</span>
                                    </div>
                                    <div class="metric-item">
                                        <span class="metric-label">ì ì •ê´‘ê³ ë¹„</span>
                                        <span class="metric-value text-success" id="appropriate_advertising_result">â‚©0</span>
                                    </div>
                                    <div class="metric-item">
                                        <span class="metric-label formula-text">ì ì •ê´‘ê³ ë¹„ = ìˆœë§¤ì¶œì•¡ Ã— ë³´ì •ê´‘ê³ ë¹„ìœ¨</span>
                                    </div>
                                    <div class="metric-item">
                                        <span class="metric-label">ì¼ë‹¹ ì ì •ê´‘ê³ ë¹„</span>
                                        <span class="metric-value text-success" id="daily_appropriate_advertising_result">â‚©0</span>
                                    </div>
                                    <div class="metric-item">
                                        <span class="metric-label formula-text">ì¼ë‹¹ ì ì •ê´‘ê³ ë¹„ = ì ì •ê´‘ê³ ë¹„ Ã· ì§‘ê³„ê¸°ê°„</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ìš”ì•½ ì •ë³´ -->
                    <div class="card">
                        <div class="card-header">
                            <h5><i data-lucide="info" class="me-2"></i>ë¶„ì„ ìš”ì•½</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="summary-item">
                                        <span class="summary-label">ì§‘ê³„ê¸°ê°„</span>
                                        <span class="summary-value" id="period_result">ìµœê·¼ 14ì¼</span>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="summary-item">
                                        <span class="summary-label">ì´ ì¼ìˆ˜</span>
                                        <span class="summary-value" id="total_days_result">14ì¼</span>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="summary-item">
                                        <span class="summary-label">ìµœì¢… ì—…ë°ì´íŠ¸</span>
                                        <span class="summary-value" id="last_updated_result">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ì´ˆê¸° ì•ˆë‚´ -->
                <div id="welcomeMessage" class="text-center py-5">
                    <i data-lucide="calculator" class="mb-3" style="width: 64px; height: 64px; color: #9ca3af;"></i>
                    <h4 class="text-muted">ë°ì´í„°ë¥¼ ì…ë ¥í•˜ê³  ë¶„ì„ì„ ì‹œì‘í•˜ì„¸ìš”</h4>
                    <p class="text-muted">ì™¼ìª½ í¼ì— ë§¤ì¶œ, í™˜ë¶ˆ, í• ì¸, ê´‘ê³ ë¹„ ì •ë³´ë¥¼ ì…ë ¥í•˜ë©´<br>ì¢…í•© ë¶„ì„ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // í”Œë¼ìŠ¤í¬ ê³„ì‚°ê¸° JavaScript
        document.addEventListener('DOMContentLoaded', function() {
            // Lucide ì•„ì´ì½˜ ì´ˆê¸°í™”
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
            
            // ê¸°ë³¸ ë‚ ì§œ ì„¤ì • (ì˜¤ëŠ˜ ê¸°ì¤€ ìµœê·¼ 14ì¼)
            setDefaultDates();
            
            // í¼ ì œì¶œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('analysisForm').addEventListener('submit', handleFormSubmit);
            
            // ì…ë ¥ í•„ë“œ ì‹¤ì‹œê°„ ìœ íš¨ì„± ê²€ì‚¬
            const inputs = document.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                input.addEventListener('input', validateInput);
            });
            
            // ë‚ ì§œ ë³€ê²½ ì‹œ ì¼ìˆ˜ ê³„ì‚°
            document.getElementById('start_date').addEventListener('change', calculateDays);
            document.getElementById('end_date').addEventListener('change', calculateDays);
        });

        // ê¸°ë³¸ ë‚ ì§œ ì„¤ì • (ì–´ì œë¶€í„° 14ì¼ê°„)
        function setDefaultDates() {
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(today.getDate() - 1); // ì–´ì œ
            
            const fourteenDaysAgo = new Date(yesterday);
            fourteenDaysAgo.setDate(yesterday.getDate() - 13); // ì–´ì œë¶€í„° 14ì¼ ì „
            
            document.getElementById('end_date').value = yesterday.toISOString().split('T')[0];
            document.getElementById('start_date').value = fourteenDaysAgo.toISOString().split('T')[0];
        }

        // ì¼ìˆ˜ ê³„ì‚°
        function calculateDays() {
            const startDate = document.getElementById('start_date').value;
            const endDate = document.getElementById('end_date').value;
            
            if (startDate && endDate) {
                const start = new Date(startDate);
                const end = new Date(endDate);
                const diffTime = Math.abs(end - start);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1; // ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ í¬í•¨
                
                // ì¼ìˆ˜ í‘œì‹œ ì—…ë°ì´íŠ¸
                const periodElement = document.getElementById('period_result');
                if (periodElement) {
                    periodElement.textContent = `${startDate} ~ ${endDate}`;
                }
                
                const daysElement = document.getElementById('total_days_result');
                if (daysElement) {
                    daysElement.textContent = `${diffDays}ì¼`;
                }
                
                return diffDays;
            }
            return 14; // ê¸°ë³¸ê°’
        }

        // í¼ ì œì¶œ ì²˜ë¦¬
        function handleFormSubmit(event) {
            event.preventDefault();
            
            try {
                // ì…ë ¥ ë°ì´í„° ìˆ˜ì§‘
                const formData = new FormData(event.target);
                const totalDays = calculateDays(); // ì¼ìˆ˜ ê³„ì‚°
                
                const data = {
                    sales_amount: parseFloat(formData.get('sales_amount')) || 0,
                    refund_amount: parseFloat(formData.get('refund_amount')) || 0,
                    total_discount: parseFloat(formData.get('total_discount')) || 0,
                    advertising_cost: parseFloat(formData.get('advertising_cost')) || 0,
                    target_ratio: (parseFloat(formData.get('target_ratio')) || 10) / 100,
                    total_days: totalDays
                };
                
                // ìœ íš¨ì„± ê²€ì‚¬
                if (!validateFormData(data)) {
                    return;
                }
                
                // ë¡œë”© í‘œì‹œ
                showLoading();
                
                // ê³„ì‚° ìˆ˜í–‰
                const results = calculateAnalysis(data);
                displayResults(results);
                
            } catch (error) {
                console.error('ê³„ì‚° ì˜¤ë¥˜:', error);
                showError('ê³„ì‚° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            } finally {
                hideLoading();
            }
        }

        // ë§¤ì¶œÂ·ê´‘ê³ Â·í• ì¸ ì¢…í•©ë¶„ì„ ê³„ì‚° í•¨ìˆ˜
        function calculateAnalysis(data) {
            const { sales_amount, refund_amount, total_discount, advertising_cost, target_ratio, total_days } = data;
            
            // ë§¤ì¶œì •ë³´ ê³„ì‚°
            const refund_ratio = sales_amount > 0 ? refund_amount / sales_amount : 0;
            const net_sales = sales_amount - refund_amount;
            const daily_avg_net_sales = net_sales / total_days;
            
            // í• ì¸ì •ë³´ ê³„ì‚°
            const effective_discount = total_discount * (1 - refund_ratio);
            const effective_discount_ratio = (net_sales + effective_discount) > 0 ? effective_discount / (net_sales + effective_discount) : 0;
            
            // ê´‘ê³ ì •ë³´ ê³„ì‚°
            const daily_avg_advertising = advertising_cost / total_days;
            const sales_advertising_ratio = net_sales > 0 ? advertising_cost / net_sales : 0;
            
            // ë³´ì •ê´‘ê³ ë¹„ìœ¨ ê³„ì‚° (í•˜í•œì„  7.5%, ìƒí•œì„  15%)
            const lower_limit = 0.075;
            const upper_limit = 0.15;
            
            let corrected_ratio;
            if (sales_advertising_ratio > 0) {
                corrected_ratio = (target_ratio ** 2) / sales_advertising_ratio;
                corrected_ratio = Math.max(lower_limit, Math.min(upper_limit, corrected_ratio));
            } else {
                corrected_ratio = target_ratio;
            }
            
            const appropriate_advertising = net_sales * corrected_ratio;
            const daily_appropriate_advertising = appropriate_advertising / total_days;
            
            return {
                sales_info: {
                    sales_amount,
                    refund_amount,
                    refund_ratio,
                    net_sales,
                    daily_avg_net_sales
                },
                discount_info: {
                    total_discount,
                    effective_discount,
                    effective_discount_ratio
                },
                advertising_info: {
                    advertising_cost,
                    daily_avg_advertising,
                    sales_advertising_ratio,
                    corrected_ratio,
                    appropriate_advertising,
                    daily_appropriate_advertising
                },
                summary: {
                    period: `${document.getElementById('start_date').value} ~ ${document.getElementById('end_date').value}`,
                    total_days: total_days,
                    last_updated: new Date().toLocaleString('ko-KR')
                }
            };
        }

        // í¼ ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬
        function validateFormData(data) {
            if (data.sales_amount < 0) {
                showError('ë§¤ì¶œì•¡ì€ 0 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                return false;
            }
            
            if (data.refund_amount < 0) {
                showError('í™˜ë¶ˆê¸ˆì•¡ì€ 0 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                return false;
            }
            
            if (data.refund_amount > data.sales_amount) {
                showError('í™˜ë¶ˆê¸ˆì•¡ì€ ë§¤ì¶œì•¡ë³´ë‹¤ í´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return false;
            }
            
            if (data.total_discount < 0) {
                showError('ì´í• ì¸ì•¡ì€ 0 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                return false;
            }
            
            if (data.advertising_cost < 0) {
                showError('ê´‘ê³ ì‹¤ë¹„ëŠ” 0 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                return false;
            }
            
            if (data.target_ratio < 0 || data.target_ratio > 1) {
                showError('ëª©í‘œ ê´‘ê³ ë¹„ìœ¨ì€ 0% ~ 100% ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.');
                return false;
            }
            
            return true;
        }

        // ì…ë ¥ í•„ë“œ ìœ íš¨ì„± ê²€ì‚¬
        function validateInput(event) {
            const input = event.target;
            const value = parseFloat(input.value);
            
            // ìŒìˆ˜ ì²´í¬
            if (value < 0) {
                input.classList.add('is-invalid');
                return;
            }
            
            // í™˜ë¶ˆê¸ˆì•¡ì´ ë§¤ì¶œì•¡ë³´ë‹¤ í°ì§€ ì²´í¬
            if (input.id === 'refund_amount') {
                const salesAmount = parseFloat(document.getElementById('sales_amount').value) || 0;
                if (value > salesAmount) {
                    input.classList.add('is-invalid');
                    return;
                }
            }
            
            input.classList.remove('is-invalid');
        }

        // ê²°ê³¼ í‘œì‹œ
        function displayResults(results) {
            // ë§¤ì¶œì •ë³´ ê²°ê³¼
            document.getElementById('sales_amount_result').textContent = formatCurrency(results.sales_info.sales_amount);
            document.getElementById('refund_amount_result').textContent = formatCurrency(results.sales_info.refund_amount);
            document.getElementById('refund_ratio_result').textContent = formatPercentage(results.sales_info.refund_ratio);
            document.getElementById('net_sales_result').textContent = formatCurrency(results.sales_info.net_sales);
            document.getElementById('daily_avg_net_sales_result').textContent = formatCurrency(results.sales_info.daily_avg_net_sales);
            
            // í• ì¸ì •ë³´ ê²°ê³¼
            document.getElementById('total_discount_result').textContent = formatCurrency(results.discount_info.total_discount);
            document.getElementById('effective_discount_result').textContent = formatCurrency(results.discount_info.effective_discount);
            document.getElementById('effective_discount_ratio_result').textContent = formatPercentage(results.discount_info.effective_discount_ratio);
            
            // ê´‘ê³ ì •ë³´ ê²°ê³¼
            document.getElementById('advertising_cost_result').textContent = formatCurrency(results.advertising_info.advertising_cost);
            document.getElementById('daily_avg_advertising_result').textContent = formatCurrency(results.advertising_info.daily_avg_advertising);
            document.getElementById('sales_advertising_ratio_result').textContent = formatPercentage(results.advertising_info.sales_advertising_ratio);
            document.getElementById('corrected_ratio_result').textContent = formatPercentage(results.advertising_info.corrected_ratio);
            document.getElementById('appropriate_advertising_result').textContent = formatCurrency(results.advertising_info.appropriate_advertising);
            document.getElementById('daily_appropriate_advertising_result').textContent = formatCurrency(results.advertising_info.daily_appropriate_advertising);
            
            // ìš”ì•½ ì •ë³´
            document.getElementById('period_result').textContent = results.summary.period;
            document.getElementById('total_days_result').textContent = `${results.summary.total_days}ì¼`;
            document.getElementById('last_updated_result').textContent = results.summary.last_updated;
            
            // ê²°ê³¼ ì»¨í…Œì´ë„ˆ í‘œì‹œ
            document.getElementById('resultsContainer').style.display = 'block';
            document.getElementById('welcomeMessage').style.display = 'none';
            
            // ë³´ê³ ì„œ ì¶”ì¶œ ë²„íŠ¼ í‘œì‹œ
            document.getElementById('exportReportBtn').style.display = 'block';
            
            // ê²°ê³¼ë¡œ ìŠ¤í¬ë¡¤
            document.getElementById('resultsContainer').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
        }

        // í†µí™” í¬ë§·íŒ…
        function formatCurrency(amount) {
            return new Intl.NumberFormat('ko-KR', {
                style: 'currency',
                currency: 'KRW',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        // í¼ì„¼íŠ¸ í¬ë§·íŒ…
        function formatPercentage(value) {
            return new Intl.NumberFormat('ko-KR', {
                style: 'percent',
                minimumFractionDigits: 1,
                maximumFractionDigits: 2
            }).format(value);
        }

        // ë¡œë”© í‘œì‹œ
        function showLoading() {
            const submitBtn = document.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i data-lucide="loader-2" class="me-1"></i>ê³„ì‚° ì¤‘...';
            submitBtn.disabled = true;
            
            // ì•„ì´ì½˜ ë‹¤ì‹œ ì´ˆê¸°í™”
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }

        // ë¡œë”© ìˆ¨ê¸°ê¸°
        function hideLoading() {
            const submitBtn = document.querySelector('button[type="submit"]');
            submitBtn.innerHTML = '<i data-lucide="play" class="me-1"></i>ë¶„ì„ ê³„ì‚°';
            submitBtn.disabled = false;
            
            // ì•„ì´ì½˜ ë‹¤ì‹œ ì´ˆê¸°í™”
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }

        // ì˜¤ë¥˜ í‘œì‹œ
        function showError(message) {
            // ê¸°ì¡´ ì˜¤ë¥˜ ë©”ì‹œì§€ ì œê±°
            const existingAlert = document.querySelector('.alert-danger');
            if (existingAlert) {
                existingAlert.remove();
            }
            
            // ìƒˆ ì˜¤ë¥˜ ë©”ì‹œì§€ ìƒì„±
            const alert = document.createElement('div');
            alert.className = 'alert alert-danger alert-dismissible fade show';
            alert.innerHTML = `
                <i data-lucide="alert-circle" class="me-2"></i>${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            // í¼ ìœ„ì— ì‚½ì…
            const form = document.getElementById('analysisForm');
            form.parentNode.insertBefore(alert, form);
            
            // ì•„ì´ì½˜ ì´ˆê¸°í™”
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
            
            // 5ì´ˆ í›„ ìë™ ì œê±°
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.remove();
                }
            }, 5000);
        }

        // ë³´ê³ ì„œ ì¶”ì¶œ
        function exportReport() {
            try {
                const reportText = generateReportText();
                
                // í´ë¦½ë³´ë“œì— ë³µì‚¬
                navigator.clipboard.writeText(reportText).then(() => {
                    showClipboardSuccess();
                }).catch(err => {
                    // í´ë¦½ë³´ë“œ APIê°€ ì§€ì›ë˜ì§€ ì•ŠëŠ” ê²½ìš° ëŒ€ì²´ ë°©ë²•
                    const textArea = document.createElement('textarea');
                    textArea.value = reportText;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    showClipboardSuccess();
                });
                
            } catch (error) {
                console.error('ë³´ê³ ì„œ ì¶”ì¶œ ì˜¤ë¥˜:', error);
                showError('ë³´ê³ ì„œ ì¶”ì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // í´ë¦½ë³´ë“œ ë³µì‚¬ ì„±ê³µ ì•Œë¦¼
        function showClipboardSuccess() {
            // ê¸°ì¡´ ì•Œë¦¼ ì œê±°
            const existingAlert = document.querySelector('.alert-success');
            if (existingAlert) {
                existingAlert.remove();
            }
            
            // ìƒˆ ì„±ê³µ ì•Œë¦¼ ìƒì„±
            const alert = document.createElement('div');
            alert.className = 'alert alert-success alert-dismissible fade show';
            alert.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            alert.innerHTML = `
                <div class="d-flex align-items-center">
                    <i data-lucide="check-circle" class="me-2" style="color: #059669;"></i>
                    <div>
                        <strong>ë³µì‚¬ ì™„ë£Œ!</strong><br>
                        <small>ë³´ê³ ì„œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.</small>
                    </div>
                    <button type="button" class="btn-close ms-auto" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            // í˜ì´ì§€ì— ì¶”ê°€
            document.body.appendChild(alert);
            
            // ì•„ì´ì½˜ ì´ˆê¸°í™”
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
            
            // 3ì´ˆ í›„ ìë™ ì œê±°
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.remove();
                }
            }, 3000);
        }

        // ë³´ê³ ì„œ í…ìŠ¤íŠ¸ ìƒì„±
        function generateReportText() {
            const startDate = document.getElementById('start_date').value;
            const endDate = document.getElementById('end_date').value;
            const totalDays = calculateDays();
            
            const salesAmount = document.getElementById('sales_amount_result').textContent;
            const refundAmount = document.getElementById('refund_amount_result').textContent;
            const refundRatio = document.getElementById('refund_ratio_result').textContent;
            const netSales = document.getElementById('net_sales_result').textContent;
            const dailyAvgNetSales = document.getElementById('daily_avg_net_sales_result').textContent;
            const totalDiscount = document.getElementById('total_discount_result').textContent;
            const effectiveDiscount = document.getElementById('effective_discount_result').textContent;
            const effectiveDiscountRatio = document.getElementById('effective_discount_ratio_result').textContent;
            
            const advertisingCost = document.getElementById('advertising_cost_result').textContent;
            const dailyAvgAdvertising = document.getElementById('daily_avg_advertising_result').textContent;
            const salesAdvertisingRatio = document.getElementById('sales_advertising_ratio_result').textContent;
            const correctedRatio = document.getElementById('corrected_ratio_result').textContent;
            const appropriateAdvertising = document.getElementById('appropriate_advertising_result').textContent;
            
            const lastUpdated = document.getElementById('last_updated_result').textContent;
            
            return `í”Œë¼ìŠ¤í¬ - ë§¤ì¶œÂ·ê´‘ê³ Â·í• ì¸ ì¢…í•©ë¶„ì„ ë³´ê³ ì„œ

ğŸ“Š ë¶„ì„ ê°œìš”
â€¢ ì§‘ê³„ê¸°ê°„: ${startDate} ~ ${endDate} (${totalDays}ì¼)
â€¢ ë¶„ì„ì¼ì‹œ: ${lastUpdated}

ğŸ’° ë§¤ì¶œì •ë³´
â€¢ ë§¤ì¶œì•¡: ${salesAmount}
â€¢ í™˜ë¶ˆê¸ˆì•¡: ${refundAmount}
â€¢ í™˜ë¶ˆë¹„ìœ¨: ${refundRatio}
â€¢ ìˆœë§¤ì¶œì•¡: ${netSales}
â€¢ ì¼í‰ê·  ìˆœë§¤ì¶œ: ${dailyAvgNetSales}

ğŸ“ˆ í• ì¸ì •ë³´
â€¢ ì´í• ì¸ì•¡: ${totalDiscount}
â€¢ ì‹¤í• ì¸ì•¡: ${effectiveDiscount}
â€¢ ì‹¤í• ì¸ë¥ : ${effectiveDiscountRatio}

ğŸ“¢ ê´‘ê³ ì •ë³´
â€¢ ê´‘ê³ ì‹¤ë¹„: ${advertisingCost}
â€¢ ì¼í‰ê·  ê´‘ê³ ì‹¤ë¹„: ${dailyAvgAdvertising}
â€¢ ë§¤ì¶œëŒ€ë¹„ ê´‘ê³ ë¹„ìœ¨: ${salesAdvertisingRatio}
â€¢ ë³´ì •ê´‘ê³ ë¹„ìœ¨: ${correctedRatio}
â€¢ ì ì •ê´‘ê³ ë¹„: ${appropriateAdvertising}
â€¢ ì¼ë‹¹ ì ì •ê´‘ê³ ë¹„: ${document.getElementById('daily_appropriate_advertising_result').textContent}

ğŸ“ ë¶„ì„ ìš”ì•½
â€¢ ìˆœë§¤ì¶œì•¡: ${netSales}
â€¢ ì ì •ê´‘ê³ ë¹„: ${appropriateAdvertising}
â€¢ ì¼í‰ê·  ìˆœë§¤ì¶œ: ${dailyAvgNetSales}
â€¢ ì¼í‰ê·  ê´‘ê³ ë¹„: ${dailyAvgAdvertising}

ìœ„ ë³´ê³ ì„œëŠ” í”Œë¼ìŠ¤í¬ ë¶„ì„ ë„êµ¬ë¡œ ìƒì„±ëœ ë³´ê³ ì„œì…ë‹ˆë‹¤.
`;
        }
    </script>
</body>
</html>
